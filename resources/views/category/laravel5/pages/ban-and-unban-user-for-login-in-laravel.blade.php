@extends('layouts.master')

@section('title')
    Laravel 5.8 | Ban & Unban User | Learn with Self
@endsection

@section('content')
    <div class="container-fluid">
        <div class="row">
            @include('category.laravel5.partials.Sideber')
            <div class="col-md-10">
                <div class="row">
                    <div class="col-md-8 border-left border-right">


                        <div class="main-heading">
                            <h1>How to Ban | Block | Disable and unBan user for login in laravel</h1>
                        </div>

                        <div class="description py-3">
                            <h3><b>How to Ban or block user for login in Laravel</b></h3><p>So guys to <b>BAN</b> or <b>BLOCK</b> user for login, we have already setup with login and registration in laravel using <b>Auth Command</b>.&nbsp;</p><p><b>Step 1:</b>&nbsp;By the following below command:</p><div class="alert funda-bg" style="width: fit-content; min-width: 100%; background-color: rgb(30, 30, 30); color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div>php&nbsp;artisan&nbsp;make:auth</div></div><p style="font-size: 17px; line-height: 2;"><br></p><p style="font-size: 17px; line-height: 2;"><b>Step 2:</b>&nbsp;&nbsp;All the setup for login and register is successfully done. Now, let's edit <b>users</b> table which is available in following folder: <b><font color="#ff0000">database / migrations / yoursomedate_create_users_table.php </font></b>and add the type column for it:</p><div class="alert funda-bg" style="width: fit-content; min-width: 100%; background-color: rgb(30, 30, 30); color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: rgb(156, 220, 254);">$table</span>-&gt;<span style="color: rgb(220, 220, 170);">tinyInteger</span>(<span style="color: rgb(206, 145, 120);">'</span><span style="color: rgb(206, 145, 120);">isban</span><span style="color: rgb(206, 145, 120);">'</span>)-&gt;<span style="color: rgb(220, 220, 170);">default</span>(<span style="color: rgb(206, 145, 120);">'0'</span>); <span style="color: rgb(106, 153, 85);">//Add&nbsp;in&nbsp;UserTable&nbsp;before&nbsp;timestamps</span><br></div></div><h5 style="line-height: 2; font-family: Poppins, sans-serif;"><span style="background-color: rgb(206, 198, 206);"><span style="font-size: 1rem;"><span style="font-weight: 900;">&nbsp; &nbsp;Note:</span>&nbsp;the value which you store in <b>isban</b>&nbsp;column: <b>0</b> = un_banned /&nbsp;<b>1 </b>= isbanned_now.&nbsp;&nbsp;</span></span></h5><p style="line-height: 2; font-family: Poppins, sans-serif;"><b>Step 3: </b>migrate this table <b>OR</b> go to your phpmyadmin and add one column named <b>isban</b> before created_at column in <b>Users Table</b>&nbsp; into database.</p><p style="line-height: 2; font-family: Poppins, sans-serif;"><b>Step 4:</b>&nbsp;Go to your Model, where path is <b><font color="#ff0000">App/User.php</font></b>&nbsp; and then paste the column name <b>isban </b>to your <b>protected $fillable </b>as given below:</p><div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: rgb(86, 156, 214);">protected</span>&nbsp;<span style="color: rgb(156, 220, 254);">$fillable</span>&nbsp;=&nbsp;[<br></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #ce9178;">'name'</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #ce9178;">'email'</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #ce9178;">'password'</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #ce9178;">'isban',</span></div><div>];</div></div><p style="line-height: 2; font-family: Poppins, sans-serif;"><br></p><p style="line-height: 2;"><span style="font-family: Poppins, sans-serif; font-size: 1rem;"><b>Step 5:</b> Now, create a middleware for checking the user is banned or not banned with the name <b>UserMiddleware</b>:</span></p><div><div class="alert funda-bg" style="width: fit-content; min-width: 100%; background-color: rgb(30, 30, 30); color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div>php&nbsp;artisan&nbsp;make:middleware&nbsp;UserMiddleware</div></div></div><div>after middleware generated go to your <b>UserMiddleware&nbsp;</b>as follows: <b><font color="#ff0000">app/Http/Middleware/UserMiddleware.php</font></b> and paste the below code:</div><div><br></div><div><div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: rgb(86, 156, 214);">use</span>&nbsp;Illuminate\Support\Facades\<span style="color: rgb(78, 201, 176);">Auth</span>;<br></div><div><br></div><div><span style="color: #569cd6;">public</span>&nbsp;<span style="color: #569cd6;">function</span>&nbsp;<span style="color: #dcdcaa;">handle</span>(<span style="color: #9cdcfe;">$request</span>,&nbsp;<span style="color: #569cd6;">Closure</span>&nbsp;<span style="color: #9cdcfe;">$next</span>)</div><div>{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c586c0;">if</span>(<span style="color: #4ec9b0;">Auth</span>::<span style="color: #dcdcaa;">check</span>()&nbsp;&amp;&amp;&nbsp;<span style="color: #4ec9b0;">Auth</span>::<span style="color: #dcdcaa;">user</span>()-&gt;<span style="color: #9cdcfe;">isban</span>)</div><div>&nbsp;&nbsp;&nbsp;&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #9cdcfe;">$banned</span>&nbsp;=&nbsp;<span style="color: #4ec9b0;">Auth</span>::<span style="color: #dcdcaa;">user</span>()-&gt;<span style="color: #9cdcfe;">isban</span>&nbsp;==&nbsp;<span style="color: #ce9178;">"1"</span>; <span style="color: rgb(106, 153, 85);">//&nbsp;"1"=&nbsp;user&nbsp;is&nbsp;banned&nbsp;/&nbsp;"0"=&nbsp;user&nbsp;is&nbsp;unBanned</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #4ec9b0;">Auth</span>::<span style="color: #dcdcaa;">logout</span>();</div><br><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c586c0;">if</span>&nbsp;(<span style="color: #9cdcfe;">$banned</span>&nbsp;==&nbsp;<span style="color: #b5cea8;">1</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #9cdcfe;">$message</span>&nbsp;=&nbsp;<span style="color: #ce9178;">'Your&nbsp;account&nbsp;has&nbsp;been&nbsp;Banned.&nbsp;Please&nbsp;contact&nbsp;administrator.'</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c586c0;">return</span>&nbsp;<span style="color: #dcdcaa;">redirect</span>()-&gt;<span style="color: #dcdcaa;">route</span>(<span style="color: #ce9178;">'login'</span>)</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;<span style="color: #dcdcaa;">with</span>(<span style="color: #ce9178;">'status'</span>,<span style="color: #9cdcfe;">$message</span>)</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;<span style="color: #dcdcaa;">withErrors</span>([<span style="color: #ce9178;">'email'</span>&nbsp;=&gt;&nbsp;<span style="color: #ce9178;">'Your&nbsp;account&nbsp;has&nbsp;been&nbsp;Banned.&nbsp;Please&nbsp;contact&nbsp;administrator.'</span>])</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(197, 134, 192);">return</span>&nbsp;$<span style="color: rgb(156, 220, 254);">next</span>(<span style="color: rgb(156, 220, 254);">$request</span>);<br></div><div>}</div></div></div><div><b><br></b></div><div><b>Step 6:</b>&nbsp;Now Register your Middleware just you created named <b>UserMiddleware</b> with the following path: <b><font color="#ff0000">app/Http/Kernel.php</font></b> and goto the <b>routeMiddleware</b> and paste the below code:</div><div><br></div><div><div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">protected</span> <span style="color: #9cdcfe;">$routeMiddleware</span> = [</div><br><div>&nbsp; &nbsp; <span style="color: #ce9178;">'isUser'</span> =&gt; \App\Http\Middleware\<span style="color: #4ec9b0;">UserMiddleware</span>::<span style="color: #569cd6;">class</span>, <span style="color: #6a9955;">//Add to the end</span></div><div>];</div></div></div><div><b style="font-family: var(--bs-font-sans-serif); font-size: 1rem;">Step 7:</b><span style="font-family: var(--bs-font-sans-serif); font-size: 1rem;">&nbsp;Set your Redirection when you are logging as user or admin or any other role provided. Goto path - </span><b style="font-family: var(--bs-font-sans-serif); font-size: 1rem;"><font color="#ff0000">app/Http/Controller/Auth/LoginController.php</font></b><span style="font-family: var(--bs-font-sans-serif); font-size: 1rem;"> and paste the below code:</span><br></div><div><br></div><div><div class="alert funda-bg" style="width: fit-content; min-width: 100%; background-color: rgb(30, 30, 30); color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><div style="line-height: 19px;"><span style="color: rgb(86, 156, 214);">use</span>&nbsp;Illuminate\Support\Facades\<span style="color: rgb(78, 201, 176);">Auth</span>;<br></div><div style="line-height: 19px;"><br></div><div style="line-height: 19px;"><div style="line-height: 19px;"><span style="color: #6a9955;">//&nbsp;&nbsp;Use&nbsp;this&nbsp;below&nbsp;to&nbsp;redirect&nbsp;</span></div></div></div><div><span style="color: rgb(86, 156, 214);">protected</span>&nbsp;<span style="color: rgb(156, 220, 254);">$redirectTo</span>&nbsp;=&nbsp;<span style="color: rgb(206, 145, 120);">'/home'</span>;</div><div><br></div><div><div style="line-height: 19px;"><span style="color: #6a9955;">//&nbsp;OR-Else =&gt; use if you already used to redirecting authentication as per role. </span></div></div><div><div style="line-height: 19px;"><div><span style="color: rgb(86, 156, 214);">protected</span>&nbsp;<span style="color: rgb(86, 156, 214);">function</span>&nbsp;<span style="color: rgb(220, 220, 170);">authenticated</span>()</div><div>{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(197, 134, 192);">if</span>(<span style="color: rgb(78, 201, 176);">Auth</span>::<span style="color: rgb(220, 220, 170);">user</span>()-&gt;<span style="color: rgb(156, 220, 254);">role_as</span>&nbsp;==&nbsp;<span style="color: rgb(206, 145, 120);">'0'</span>)&nbsp;<span style="color: rgb(106, 153, 85);">//&nbsp;Normal&nbsp;or&nbsp;Default&nbsp;User&nbsp;Login</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(197, 134, 192);">return</span>&nbsp;<span style="color: rgb(220, 220, 170);">redirect</span>(<span style="color: rgb(206, 145, 120);">'/home'</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>}</div></div></div></div><p style="font-size: 17px; line-height: 2;"><br style="font-family: Poppins, sans-serif;"></p></div><div><b>Step 8:</b>&nbsp;Lets Setup the <b>Route</b> for this Process/Checking of <b>isbanned&nbsp;</b>and <b>unbanned&nbsp;</b>user&nbsp; as give below:</div><div><br></div><div><div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: #4ec9b0;">Route</span>::<span style="color: #dcdcaa;">group</span>([<span style="color: #ce9178;">'middleware'</span>&nbsp;=&gt;&nbsp;[<span style="color: #ce9178;">'auth'</span>,<span style="color: #ce9178;">'isUser'</span>]],&nbsp;<span style="color: #569cd6;">function</span>&nbsp;()&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #4ec9b0;">Route</span>::<span style="color: #dcdcaa;">get</span>(<span style="color: #ce9178;">'/home'</span>,&nbsp;<span style="color: #ce9178;">'HomeController@index'</span>)-&gt;<span style="color: #dcdcaa;">name</span>(<span style="color: #ce9178;">'home'</span>);<br></div><div>});</div></div></div><div><br></div>
                            <div><b>Step 9:</b>&nbsp;Finally, Now you have to paste the code the check the <b>message </b>you get from your <b>UserMiddleware </b>created from your path&nbsp;<span style="color: rgb(255, 0, 0); font-weight: bolder; font-size: 1rem;">resource/view/auth/login.blade.php</span><span style="font-size: 1rem;">&nbsp;page file.</span></div>
                            <div><span style="font-size: 1rem;"><br></span></div>


                            <div>
                                <div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot, monospace; font-size: 14px; line-height: 19px; white-space: pre;">  <span>@</span>if <span>(</span>session<span>(</span>'status'<span>))</span><br><span style="white-space: pre;">   </span><span><</span>div <span>class</span>=<span>"alert alert-danger"</span><span>{</span><span>{</span><span> session</span><span>(</span><span>'status'</span><span>) </span><span>}</span><span>}</span><<span>/</span>div<span>></span><br> <span> @</span><span>endif <br></span> <br> <span><</span><span>from </span><span>method</span>=<span>"POST"</span><span> action </span>= <span>"</span><span>{</span><span>{ </span><span>route</span><span>(</span><span>'login'</span><span>) </span><span>}</span><span>}</span><span>"</span><span>></span><br><span style="white-space: pre;">      </span><span>@</span><span>csrf</span>

                                </div>
                           </div>



                                <div><span style="font-size: 1rem;"><br></span></div>
                            <div>
                                <span style="font-size: 1rem;"><b>Step 10:</b>&nbsp;Finally we are done with above thing to ban a user, so now lets register the 1 user. Example: Email: user@gmail.com, Password: 12345678, and now click to register, so once you get registered your <b>isban</b> column stores the default value as <b>"0",</b>&nbsp;so if you want to block the user, change the <b>isban</b> column value to <b>"1".&nbsp;&nbsp;</b></span><span style="font-size: 1rem;">by below command <b>or </b>directly on phpmyadmin <b>or </b>create a CRUD:</span>
                            </div><div><span style="font-size: 1rem;"><br></span></div>
                            <div>
                                <div class="alert funda-bg" style="width: fit-content; min-width: 100%; background-color: rgb(30, 30, 30); color: rgb(212, 212, 212); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div>$&nbsp;php&nbsp;artisan&nbsp;tinker</div><br><div>&gt;&gt;&gt;&nbsp;use&nbsp;App\User;</div><div>&gt;&gt;&gt;User::where('email',&nbsp;'user@gmail.com')-&gt;update(['isban'&nbsp;=&gt;&nbsp;'1']);</div></div>
                            </div><div><br></div><div><b>Step 11:</b>&nbsp;Serve your artisan and get started with it. Thank you.</div><div><br></div><div><div class="alert funda-bg" style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div>php&nbsp;artisan&nbsp;serve</div></div></div><div><br></div>
                        </div>

                        <div class="col-md-12 mt-3">
                            <div class="row">
                                <div class="col-md-6 col-6 text-start">
                                    <a href="{{ url('/laravel-5-8/user-and-admin-login-system-in-laravel') }}" class="bg-blue px-5 btn text-white" ><i class="fa fa-arrow-left me-2"></i> Prev </a>
                                </div>
                                <div class="col-md-6 col-6 text-end">
                                    <a href="{{ url('/laravel-5-8/generate-sitemap-automatically-in-laravel') }}" class="bg-blue px-5 btn text-white" >Next <i class="fa fa-arrow-right ms-2"></i></a>
                                </div>
                            </div>
                        </div>

                    </div>
                    @include('category.laravel5.partials.latestPost')
                </div>
            </div>
        </div>
    </div>
@endsection
